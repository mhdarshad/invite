# Name of the Current Work Flow
name: "CD Packege Chang"

# Branch For the Action to Run
on:
  push:
    branches:
      - master

jobs:
  pre-release:
    name: Build And Deploy Flutter Web in Prod
    runs-on: "ubuntu-latest"
    # Declare the ENV Variables
    env:
      RELEASE_PATH: "releases/"
      COMMENT: "Nothing to say.."
      PR_NUMBER: "0"
      MODE: "release"
      CD_PATH: "CD/"
      ENVIRONMENT: "stg"
      distribution: ${{ secrets.AWS_DISTRIBUTION_ID_STG }}
    steps:
    - uses: actions/checkout@v1
    - uses: subosito/flutter-action@v1
      with:
       flutter-version: '3.7.4'
       channel: stable
# Flutter Build Actions
    - name: Install Depedencies
      run: flutter pub get

    - name: Change Packege
      run: |
        flutter clean 
        flutter pub get
        sed -i "s/applicationId 'com.example.examplepackagechange'/applicationId 'com.cts.ar.demo'/g" android/app/build.gradle
        flutter build apk
    - name: Upload file to repo
       run: |
         git clone https://github.com/mhdarshad/invite.git
         cp -R build/app/outputs/flutter-apk/* build/app/outputs/flutter-apk/
         cd build/app/outputs/flutter-apk/
         git add .
         git commit -m "Add app files"
         git push origin release
